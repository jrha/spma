###############################################################################
To-Do List for the SPMA

$Id: TODO.txt,v 1.17 2004/01/10 20:23:12 gcancio Exp $

###############################################################################

- SPM local managed list file should be guarded against crash during
  rewrite.  Maybe write to temp and then delete/rename. Eg. /var full.

- enable 'pre' and 'post' execution scripts for error recovery etc (not
  to confuse with rpm 'pre'/'post')

- rock-proof tests for 'priority to user packages'. 
  Also consider signals and application crashes with this option enabled.

- Add tests: refuse to deinstall all packages whatever the circumstances
  (already done when userpkgs=no)

- do not invoke merge_after if there were no operations executed, as
  this means that no changes were done to the installed pkgs.

- implement a lockfile to avoid multiple simultaneous invokations.

- join VERSION and RELEASE since separated concepts do not exist
  in PKG. This difference should be handled inside SPM::RPMPkgr

- port the SPMA to the CAF framework:
  - make exception reporting fully compatible with CAF:: (eg. stacktrace
    reporting)

- new attributes support:
   - REBOOT
   - OFFPROD
   - UPDATEONLY (only upgrade package X if already installed)

- Cache:
  - Cache management:
    - 'updatecache' mode (new packages are downloaded on cache,
      old packages (not in target or already installed) are 
      cleared out from cache. Should work for HTTP and sharedFS
      at the beginning. Tolerance when cache is full (issue warning)
  - Support for local cache package integrity verifications.

- Check EPOCH timestamp in RPM:
  for i in `rpm -qa` ; do echo $i: `rpm -q --qf '[%{epoch}]' $i` ; done
  Should be treated as an optional flag.

- Port Tests in Tests/ to new SPMA version.

- logrotate entries.


Longer term issues:
-------------------

- Investigate feasibility of checking for modified flags from current to 
  target configuration. Would need to store current flags in a local db.

- Investigate feasibility of moving some of the repository 'selection' logic
  into the client, eg. by publishing content lists by the repositories and
  then selecting in runtime (using defaults and hints) which repository to
  use (assuming a pkg is always the same wherever it comes from).

- Investigate possibility of editing the SPMA local config file by desktop
  users, instead of going via the CDB. Consider using 'default' production
  information. A user interface would need the knowledge of what is 'pro'
  and what else is available on which repositories (provide this externally
  or via NVA API (lots of data?)

#############################################################################
# FIXED or in PROGRESS
#############################################################################


- add a switch for 'user packages only' operations (no packages are claimed by
  the SPMA).

- rpmdb lock removal using lsof (optional switch for <= rpm4.0) 

- pre-caching of software packages, for massive installation support
  (in order to decrease PEAK load on repositories)

- Remove support for ISUNWANTED by the user. If a user removes a
  package managed by the SPMA, it will be reinstalled at the next run.

- when spma receives a signal (eg SIGTERM) we have to be careful how
  we leave the machine. Typically, this could happen during the rpmt
  run (which may take 99% of the time). If it happens, the
  configuration has to be such that the locallist is up to date, so
  that pkgs which have been installed by rpmt are not taken for
  locally installed packages.


- The 'ISUNWANTED' packages may refer not to a
  package-version-release-architecture, but maybe more globally to a
  package-version, or even a package. Also, a ISUNWANTED package does
  never have an associated URL.

  I would suggest to allow using a wildcard character for the
  ISUNWANTED packages. Something like

	     # no release of openssh 1.0.1 tolerated as insecure
	     <none> openssh 1.0.1 * * ISUNWANTED
	     # product irc_client not tolerated as timewaste
	     <none> irc_client * * * ISUNWANTED

- Situation: Allow User packages is set, but not Priority to user
             packages.

  SPM has a pkg in 'desiredlist' which has already been locally
  installed. Currently, the spma will not add this package to the
  'locallist'. I think it should be, since this package should be
  managed centrally. If it is centrally decided to remove the package,
  it currently can't be done.

- Hm, if I have a package version I don't want to have and I flag it
  as ISUNWANTED, why doesn't it like it?

     root [asis-w6] ~ # /opt/edg/bin/spma 

     Log: Inconsistent target list. All packages must be MANDATORY or
     UNWANTED if either is specified.

     (I had a version as ISUNWANTED, another one without any flag in
     my target list)

    $pkg = Package->new( undef, "Trojan-Horse", "*", "*", "i386",
			 { "isunwanted" => 1 } );
    ..
